<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Lite — Results</title>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>
*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
:root{
  --bg:#080b10;--surface:#0f1420;--surface2:#131925;--surface3:#1a2235;--surface4:#1f2840;
  --border:rgba(255,255,255,0.06);--border2:rgba(255,255,255,0.1);--border3:rgba(255,255,255,0.04);
  --fg:#f0f4ff;--fg2:#8892a4;--fg3:#3d4a5c;
  --green:#00f5a0;--green-glow:rgba(0,245,160,0.12);--green-dim:rgba(0,245,160,0.08);
  --red:#ff4d6d;--red-dim:rgba(255,77,109,0.08);
  --amber:#ffb830;--amber-dim:rgba(255,184,48,0.08);
  --blue:#4d9fff;--blue-dim:rgba(77,159,255,0.08);
}
html,body{height:100%;background:var(--bg);color:var(--fg);font-family:'DM Sans',sans-serif;overflow:hidden;}
body::before{content:'';position:fixed;inset:0;background:radial-gradient(ellipse 80% 50% at 10% 0%, rgba(0,245,160,0.03) 0%,transparent 50%),radial-gradient(ellipse 60% 60% at 90% 100%, rgba(77,159,255,0.03) 0%,transparent 50%);pointer-events:none;z-index:0;}
.shell{display:flex;height:100vh;position:relative;z-index:1;}

/* Sidebar */
.sidebar{width:210px;background:var(--surface);border-right:1px solid var(--border);display:flex;flex-direction:column;flex-shrink:0;}
.sidebar-top{padding:16px 14px;border-bottom:1px solid var(--border);}
.back{display:flex;align-items:center;gap:6px;color:var(--fg2);text-decoration:none;font-size:12px;margin-bottom:12px;transition:color 0.15s;}
.back:hover{color:var(--fg);}
.pin-display{font-family:'DM Mono',monospace;font-size:18px;font-weight:500;letter-spacing:0.14em;color:var(--green);text-shadow:0 0 16px rgba(0,245,160,0.3);}
.pin-meta{font-size:10px;color:var(--fg2);margin-top:3px;}
.tab-list{flex:1;padding:10px 8px;overflow-y:auto;}
.tab-sect{font-size:9px;font-weight:600;letter-spacing:0.1em;text-transform:uppercase;color:var(--fg3);padding:10px 8px 4px;}
.tab-item{display:flex;align-items:center;justify-content:space-between;padding:8px 10px;border-radius:10px;font-size:12px;color:var(--fg2);cursor:pointer;transition:all 0.15s;user-select:none;margin-bottom:1px;}
.tab-item:hover{color:var(--fg);background:var(--surface3);}
.tab-item.active{color:var(--green);background:var(--green-dim);}
.tab-label{display:flex;align-items:center;gap:8px;}
.hit-ct{font-size:9px;font-weight:600;padding:1px 6px;border-radius:20px;background:var(--red-dim);color:var(--red);border:1px solid rgba(255,77,109,0.2);}
.hit-ct.zero{background:transparent;color:var(--fg3);border-color:transparent;}

/* Content */
.content{flex:1;display:flex;flex-direction:column;overflow:hidden;}
.topbar{height:52px;background:var(--surface);border-bottom:1px solid var(--border);display:flex;align-items:center;padding:0 24px;gap:12px;flex-shrink:0;}
.page-title{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;}
.vbadge{font-size:10px;font-weight:700;letter-spacing:0.06em;text-transform:uppercase;padding:4px 12px;border-radius:20px;}
.vbadge.CHEATER{color:var(--red);background:var(--red-dim);border:1px solid rgba(255,77,109,0.25);}
.vbadge.SUSPICIOUS{color:var(--amber);background:var(--amber-dim);border:1px solid rgba(255,184,48,0.25);}
.vbadge.CLEAN{color:var(--green);background:var(--green-dim);border:1px solid rgba(0,245,160,0.25);}
.topbar-right{margin-left:auto;font-size:11px;color:var(--fg2);}

.main{flex:1;overflow-y:auto;padding:24px;}
.tab-panel{display:none;}
.tab-panel.active{display:block;animation:rise 0.25s cubic-bezier(0.16,1,0.3,1);}
@keyframes rise{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

/* Info grid */
.info-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-bottom:20px;}
.info-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px 16px;}
.info-label{font-size:9px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--fg3);margin-bottom:6px;}
.info-value{font-size:14px;font-weight:500;}
.info-value.mono{font-family:'DM Mono',monospace;font-size:12px;}
.info-value.red{color:var(--red);}
.info-value.green{color:var(--green);}
.info-value.amber{color:var(--amber);}

/* Auto fail banner */
.autofail-banner{background:var(--red-dim);border:1px solid rgba(255,77,109,0.3);border-radius:14px;padding:14px 18px;margin-bottom:18px;display:flex;align-items:center;gap:12px;}
.autofail-icon{font-size:20px;}
.autofail-title{font-family:'Syne',sans-serif;font-size:14px;font-weight:700;color:var(--red);}
.autofail-sub{font-size:11px;color:rgba(255,77,109,0.7);margin-top:2px;}

/* Detection bars */
.det-row{display:flex;align-items:center;gap:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 16px;margin-bottom:6px;transition:border-color 0.15s;}
.det-row.hit{border-color:rgba(255,77,109,0.2);background:rgba(255,77,109,0.04);}
.det-row.warn{border-color:rgba(255,184,48,0.2);}
.det-name{font-size:12px;font-weight:500;width:140px;flex-shrink:0;}
.det-bar-wrap{flex:1;height:4px;background:var(--surface3);border-radius:4px;overflow:hidden;}
.det-bar{height:100%;border-radius:4px;transition:width 0.6s cubic-bezier(0.16,1,0.3,1);}
.det-row.hit .det-bar{background:var(--red);}
.det-row.warn .det-bar{background:var(--amber);}
.det-row:not(.hit):not(.warn) .det-bar{background:var(--fg3);}
.det-count{font-family:'DM Mono',monospace;font-size:11px;color:var(--fg2);width:24px;text-align:right;flex-shrink:0;}

/* Account cards */
.acc-card{background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:18px;margin-bottom:12px;}
.acc-head{display:flex;align-items:center;gap:12px;margin-bottom:14px;}
.acc-icon{width:40px;height:40px;border-radius:12px;background:var(--green-dim);border:1px solid rgba(0,245,160,0.2);display:flex;align-items:center;justify-content:center;font-family:'Syne',sans-serif;font-size:16px;font-weight:700;color:var(--green);flex-shrink:0;}
.acc-name{font-family:'Syne',sans-serif;font-size:15px;font-weight:700;}
.acc-id{font-size:11px;color:var(--fg2);font-family:'DM Mono',monospace;margin-top:2px;}
.acc-id a{color:var(--blue);text-decoration:none;}
.acc-id a:hover{text-decoration:underline;}
.acc-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.acc-field{background:var(--surface2);border-radius:10px;padding:10px 14px;}
.afl{font-size:9px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--fg3);margin-bottom:4px;}
.afv{font-size:12px;color:var(--fg2);font-family:'DM Mono',monospace;}

/* Warn box */
.warn-box{background:rgba(255,77,109,0.06);border:1px solid rgba(255,77,109,0.2);border-radius:12px;padding:12px 16px;margin-bottom:16px;font-size:12px;color:rgba(255,77,109,0.9);}
.warn-box.amber{background:rgba(255,184,48,0.06);border-color:rgba(255,184,48,0.2);color:rgba(255,184,48,0.9);}

/* Raw pre */
.raw-pre{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:16px;font-family:'DM Mono',monospace;font-size:11px;color:var(--fg2);white-space:pre-wrap;word-break:break-all;max-height:420px;overflow-y:auto;line-height:1.7;}
.section-label{font-size:10px;font-weight:600;letter-spacing:0.08em;text-transform:uppercase;color:var(--fg2);margin-bottom:10px;margin-top:18px;}
.section-label:first-child{margin-top:0;}

/* Pending */
.pending-wrap{display:flex;flex-direction:column;align-items:center;justify-content:center;height:340px;}
.pending-ring{width:64px;height:64px;border-radius:50%;border:2px solid var(--border2);border-top-color:var(--green);animation:spin 1.2s linear infinite;margin-bottom:20px;}
@keyframes spin{to{transform:rotate(360deg)}}
.pending-title{font-family:'Syne',sans-serif;font-size:17px;font-weight:700;margin-bottom:6px;}
.pending-sub{font-size:13px;color:var(--fg2);}

::-webkit-scrollbar{width:4px;}
::-webkit-scrollbar-track{background:transparent;}
::-webkit-scrollbar-thumb{background:var(--surface3);border-radius:4px;}
</style>
</head>
<body>
{% set has_scan = scan is not none %}
{% set report = scan.report if has_scan else {} %}
{% set verdict = scan.verdict if has_scan else 'PENDING' %}
{% set roblox_accs = scan.roblox_accounts if has_scan else [] %}
{% set sys_hits = (report.get('shellbag_hits',0)|int + report.get('bam_hits',0)|int + report.get('prefetch_hits',0)|int + report.get('appcompat_hits',0)|int + report.get('sysmain_hits',0)|int) %}

<div class="shell">
<nav class="sidebar">
  <div class="sidebar-top">
    <a href="/dashboard" class="back">← Back</a>
    <div class="pin-display">{{ pin.pin }}</div>
    <div class="pin-meta">{{ pin.league }} · {{ 'Completed' if has_scan else 'Waiting for scan' }}</div>
  </div>
  <div class="tab-list">
    <div class="tab-sect">Overview</div>
    <div class="tab-item active" onclick="tab('summary',this)"><div class="tab-label">◈ Summary</div></div>
    <div class="tab-sect">Player</div>
    <div class="tab-item" onclick="tab('roblox',this)">
      <div class="tab-label">◉ Roblox</div>
      <span class="hit-ct {{ 'zero' if not roblox_accs else '' }}">{{ roblox_accs|length }}</span>
    </div>
    <div class="tab-item" onclick="tab('discord',this)"><div class="tab-label">◉ Discord</div></div>
    <div class="tab-sect">System</div>
    <div class="tab-item" onclick="tab('sysanalysis',this)">
      <div class="tab-label">◉ System Analysis</div>
      <span class="hit-ct {{ 'zero' if sys_hits == 0 else '' }}">{{ sys_hits }}</span>
    </div>
    <div class="tab-item" onclick="tab('cheatfiles',this)">
      <div class="tab-label">◉ Cheat Files</div>
      <span class="hit-ct {{ 'zero' if not report.get('cheat_hits',0)|int else '' }}">{{ report.get('cheat_hits',0) }}</span>
    </div>
    <div class="tab-item" onclick="tab('unsigned',this)"><div class="tab-label">◉ Unsigned Files</div></div>
    <div class="tab-sect">Additional</div>
    <div class="tab-item" onclick="tab('tamper',this)"><div class="tab-label">◉ Tamper Detection</div></div>
    <div class="tab-item" onclick="tab('raw',this)"><div class="tab-label">◉ Raw Report</div></div>
  </div>
</nav>

<div class="content">
  <div class="topbar">
    <div class="page-title">{{ scan.pc_user if has_scan else pin.pin }}</div>
    {% if has_scan %}<span class="vbadge {{ verdict }}">{{ verdict }}</span>{% endif %}
    <div class="topbar-right">
      {{ pin.league }}{% if has_scan %} · Submitted {{ scan.submitted }}{% endif %}
    </div>
  </div>

  <div class="main">
  {% if not has_scan %}
  <div class="pending-wrap">
    <div class="pending-ring"></div>
    <div class="pending-title">Waiting for scan</div>
    <div class="pending-sub">The player hasn't run the scan with this PIN yet.</div>
  </div>
  {% else %}

    <!-- SUMMARY -->
    <div class="tab-panel active" id="tab-summary">
      {% if report.get('sysmain_autofail') %}
      <div class="autofail-banner"><div class="autofail-icon">⚠</div><div><div class="autofail-title">AUTO FAIL</div><div class="autofail-sub">SysMain disabled + Prefetch empty — deliberate trace wiping detected</div></div></div>
      {% endif %}
      <div class="info-grid">
        <div class="info-card"><div class="info-label">PC User</div><div class="info-value mono">{{ scan.pc_user }}</div></div>
        <div class="info-card"><div class="info-label">League</div><div class="info-value mono">{{ scan.league }}</div></div>
        <div class="info-card"><div class="info-label">Total Hits</div><div class="info-value {{ 'red' if scan.total_hits > 0 else 'green' }}">{{ scan.total_hits }}</div></div>
        <div class="info-card"><div class="info-label">Submitted</div><div class="info-value mono" style="font-size:11px">{{ scan.submitted }}</div></div>
        <div class="info-card"><div class="info-label">Scan Finished</div><div class="info-value mono" style="font-size:11px">{{ pin.finished_at or '—' }}</div></div>
        <div class="info-card"><div class="info-label">Scan ID</div><div class="info-value mono">#{{ scan.id }}</div></div>
      </div>
      {% set det_rows = [
        ('ShellBag', report.get('shellbag_hits',0)|int, 10),
        ('BAM', report.get('bam_hits',0)|int, 10),
        ('Prefetch', report.get('prefetch_hits',0)|int, 10),
        ('AppCompat', report.get('appcompat_hits',0)|int, 10),
        ('Cheat Files', report.get('cheat_hits',0)|int, 5),
        ('YARA', report.get('yara_hits',0)|int, 5),
        ('Unsigned EXEs', report.get('unsigned_count',0)|int, 20),
        ('SysMain', report.get('sysmain_hits',0)|int, 8),
        ('Log Tamper', report.get('roblox_hits',0)|default(0)|int, 6),
        ('FastFlags', report.get('fastflags',[])|length, 5),
      ] %}
      {% for name, val, max in det_rows %}
      {% set pct = [((val / max) * 100)|int, 100]|min if max > 0 else 0 %}
      <div class="det-row {{ 'hit' if val > 0 else '' }}">
        <div class="det-name">{{ name }}</div>
        <div class="det-bar-wrap"><div class="det-bar" style="width:{{ pct }}%"></div></div>
        <div class="det-count">{{ val }}</div>
      </div>
      {% endfor %}
    </div>

    <!-- ROBLOX -->
    <div class="tab-panel" id="tab-roblox">
      {% if roblox_accs|length > 1 %}<div class="warn-box">⚠ {{ roblox_accs|length }} Roblox accounts detected — possible ban evasion or alt account</div>{% endif %}
      {% for acc in roblox_accs %}
        {% if acc is mapping %}
        <div class="acc-card">
          <div class="acc-head">
            <div class="acc-icon">{{ acc.username[0].upper() if acc.username and acc.username != 'Unknown' else '?' }}</div>
            <div>
              <div class="acc-name">{{ acc.username or 'Unknown' }}</div>
              <div class="acc-id">{% if acc.userid %}<a href="https://www.roblox.com/users/{{ acc.userid }}/profile" target="_blank">{{ acc.userid }} ↗</a>{% else %}Unknown ID{% endif %}</div>
            </div>
          </div>
          <div class="acc-grid">
            <div class="acc-field"><div class="afl">Last Seen</div><div class="afv">{{ acc.last_seen or '—' }}</div></div>
            <div class="acc-field"><div class="afl">Sources</div><div class="afv">{{ ', '.join(acc.sources) if acc.sources else '—' }}</div></div>
            <div class="acc-field" style="grid-column:1/-1"><div class="afl">Place IDs</div><div class="afv">{% if acc.placeids %}{% for pid in acc.placeids %}<a href="https://www.roblox.com/games/{{ pid }}" target="_blank" style="color:var(--blue);text-decoration:none">{{ pid }}</a>{% if not loop.last %}, {% endif %}{% endfor %}{% else %}—{% endif %}</div></div>
          </div>
        </div>
        {% else %}
        <div class="acc-card"><div class="acc-name">{{ acc }}</div></div>
        {% endif %}
      {% else %}
      <div style="color:var(--fg2);font-size:13px;padding:16px 0">No Roblox accounts detected.</div>
      {% endfor %}
      {% if report.get('fastflags') %}
      <div class="section-label" style="margin-top:20px">FastFlags Detected ({{ report.fastflags|length }})</div>
      {% for ff in report.fastflags %}<div class="warn-box amber" style="margin-bottom:6px;font-family:'DM Mono',monospace;font-size:11px">{{ ff }}</div>{% endfor %}
      {% endif %}
    </div>

    <!-- DISCORD -->
    <div class="tab-panel" id="tab-discord">
      {% if report.get('discord_accounts') %}
      {% for acc in report.discord_accounts %}
      <div class="acc-card">
        <div class="acc-head">
          <div class="acc-icon" style="background:rgba(88,101,242,0.1);border-color:rgba(88,101,242,0.2);color:#8891f7;font-size:18px">D</div>
          <div><div class="acc-name">{{ acc.username or 'Unknown' }}</div><div class="acc-id">{{ acc.id or '—' }}</div></div>
        </div>
        <div class="acc-grid">
          <div class="acc-field"><div class="afl">Token Found</div><div class="afv" style="color:{{ 'var(--red)' if acc.has_token else 'var(--fg3)' }}">{{ 'YES — suspicious' if acc.has_token else 'No' }}</div></div>
          <div class="acc-field"><div class="afl">Source</div><div class="afv">{{ acc.source or '—' }}</div></div>
        </div>
      </div>
      {% endfor %}
      {% else %}
      <div style="color:var(--fg2);font-size:13px;padding:16px 0">No Discord account data found in local cache.</div>
      {% endif %}
    </div>

    <!-- SYSTEM ANALYSIS -->
    <div class="tab-panel" id="tab-sysanalysis">
      <div class="section-label">Factory Reset History</div>
      <div class="raw-pre">{{ report.get('factory_resets') or 'No factory reset history found.' }}</div>
      <div class="section-label">SysMain / Prefetch Service</div>
      <div class="raw-pre">{{ report.get('sysmain_raw','No data') }}</div>
      <div class="section-label">ShellBags</div>
      <div class="raw-pre">{{ report.get('shellbags_raw','No data') }}</div>
      <div class="section-label">BAM</div>
      <div class="raw-pre">{{ report.get('bam_raw','No data') }}</div>
      <div class="section-label">Prefetch</div>
      <div class="raw-pre">{{ report.get('prefetch_raw','No data') }}</div>
      <div class="section-label">AppCompat / UserAssist</div>
      <div class="raw-pre">{{ report.get('appcompat_raw','No data') }}</div>
    </div>

    <!-- CHEAT FILES -->
    <div class="tab-panel" id="tab-cheatfiles">
      <div class="section-label">Cheat Files</div>
      <div class="raw-pre">{{ report.get('cheat_raw','No data') }}</div>
      <div class="section-label">Deleted Cheat Files (Recycle Bin)</div>
      <div class="raw-pre">{{ report.get('recycle_raw','No data') }}</div>
    </div>

    <!-- UNSIGNED -->
    <div class="tab-panel" id="tab-unsigned">
      <div class="section-label">Unsigned Executables ({{ report.get('unsigned_count',0) }})</div>
      <div class="raw-pre">{{ report.get('unsigned_raw','No data') }}</div>
    </div>

    <!-- TAMPER -->
    <div class="tab-panel" id="tab-tamper">
      <div class="section-label">Log Integrity & Tamper Detection</div>
      <div class="raw-pre">{{ report.get('roblox_raw','No data') }}</div>
      <div class="section-label">Drive Detection</div>
      {% if report.get('drive_warn') %}<div class="warn-box amber" style="margin-bottom:10px">⚠ External drive activity detected</div>{% endif %}
      <div class="raw-pre">{{ report.get('drive_info','No data') }}</div>
    </div>

    <!-- RAW -->
    <div class="tab-panel" id="tab-raw">
      <div class="raw-pre">{{ report.get('full_report','No raw report.') }}</div>
    </div>

  {% endif %}
  </div>
</div>
</div>
<script>
function tab(k,el){
  document.querySelectorAll('.tab-panel').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.tab-item').forEach(t=>t.classList.remove('active'));
  const p=document.getElementById('tab-'+k);
  if(p)p.classList.add('active');
  if(el)el.classList.add('active');
}
</script>
</body>
</html>
